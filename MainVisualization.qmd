---
title: "Main_Visualization"
format: html
editor: visual
---

```{r}
# Load necessary libraries
library(ggplot2)
library(dplyr)
library(readr)
library(tidyr)
library(ggnewscale)
```

```{r}
# Load the dataset
cancer_data <- read_csv("cancer-dataset.csv")
#show head of the dataset
head(cancer_data)
```

```{r}
# Filter data for the year 2019 and measure 'Deaths'
cancer_data_2019 <- cancer_data %>%
  filter(year == 2019, measure_name == "Deaths", age_name == "All ages") %>%
  select(cause_name, sex_name, val)

# Remove "Total cancers" and "Total excl. non-melanoma" from the dataset
cancer_data_2019 <- cancer_data_2019 %>%
      filter(!cause_name %in% c("Total cancers", "Total Cancers excluding Non-melanoma skin cancer"))

# Define new cancer groups
cancer_data_2019 <- cancer_data_2019 %>%
  mutate(cause_group = case_when(
    cause_name %in% c("Eye cancer", "Soft tissue and other extraosseous sarcomas", "Malignant neoplasm of bone and articular cartilage", "Neuroblastoma and other peripheral nervous cell tumors") ~ "Rare cancers",
    cause_name %in% c("Breast cancer", "Cervical cancer", "Uterine cancer", "Prostate cancer", "Ovarian cancer", "Testicular cancer") ~ "Reproductive cancers",
    cause_name %in% c("Colon and rectum cancer", "Stomach cancer", "Esophageal cancer") ~ "Digestive system cancers",
    cause_name %in% c("Lip and oral cavity cancer", "Nasopharynx cancer", "Other pharynx cancer", "Larynx cancer") ~ "Head and neck cancers",
    cause_name %in% c("Gallbladder and biliary tract cancer", "Liver cancer", "Pancreatic cancer") ~ "Liver and pancreas cancers",
    cause_name %in% c("Malignant skin melanoma", "Non-melanoma skin cancer") ~ "Skin cancers",
    cause_name %in% c("Kidney cancer", "Bladder cancer") ~ "Urinary system cancers",
    cause_name %in% c("Brain and central nervous system cancer") ~ "Brain cancers",
    cause_name %in% c("Thyroid cancer") ~ "Thyroid cancers",
    cause_name %in% c("Mesothelioma") ~ "Mesothelioma",
    cause_name %in% c("Hodgkin lymphoma", "Non-Hodgkin lymphoma") ~ "Lymphomas",
    cause_name %in% c("Multiple myeloma") ~ "Multiple myeloma",
    cause_name %in% c("Leukemia") ~ "Leukemia",
    cause_name %in% c("Tracheal, bronchus, and lung cancer") ~ "Lung cancer",
    cause_name %in% c("Other malignant neoplasms", "Other neoplasms") ~ "Other cancers",
    TRUE ~ cause_name
  ))

# TODO:  Find out about proper classifications of cancer to help support our groupings and change it if necessary


# TODO: Create the sequential color scheme for both female and male (reference the picture sent in the group)


# Group by new cancer groups and sum the values
cancer_data_grouped <- cancer_data_2019 %>%
  group_by(cause_group, sex_name) %>%
  summarise(val = sum(val, na.rm = TRUE))

```

```{r}
# Pivot the data
cancer_data_long <- cancer_data_grouped %>%
  pivot_wider(names_from = sex_name, values_from = val, values_fill = list(val = 0))

# Round the values to 2 decimal places
cancer_data_long <- cancer_data_long %>%
  mutate(across(c(Male, Female), round, 2))

# Adjust the sign for female deaths to create a bi-directional effect
cancer_data_long_base <- cancer_data_long %>%
  mutate(Female = -Female)
```

```{r}
# Base Plot

# TODO: Make the asthetics of the plot more visually appealing (In terms of shifting around the elements, resizing the plot and ect...)

# Create the plot
p <- ggplot(cancer_data_long_base, aes(x = reorder(cause_group, abs(Female) + Male))) +
  geom_bar(aes(y = Male, fill = "Male"), stat = "identity", width = 0.8) +
  geom_bar(aes(y = Female, fill = "Female"), stat = "identity", width = 0.8) +
  coord_flip() +
  scale_y_continuous(labels = abs) +
  labs(title = "Cancer Deaths by Type and Gender, World, 2019",
       x = "Cancer Type",
       y = "Number of Deaths",
       fill = "Gender") +
  scale_fill_manual(values = c("Male" = "blue", "Female" = "pink")) +
  theme_minimal() +
  theme(axis.text.y = element_text(size = 10),
        axis.title.y = element_text(size = 12),
        axis.title.x = element_text(size = 12),
        plot.title = element_text(size = 16, face = "bold")) +
  geom_text(aes(y = Female, label = formatC(abs(Female), format = "d", big.mark = ",")), 
            position = position_stack(vjust = 0.5), hjust = 1.1, size = 3) +
  geom_text(aes(y = Male, label = formatC(Male, format = "d", big.mark = ",")), 
            position = position_stack(vjust = 0.5), hjust = -0.1, size = 3)

# Save the plot as an image with larger dimensions
# ggsave("Cancer_Deaths_by_Type_and_Gender_2019.png", plot = p, width = 20, height = 15, dpi = 300)

p

```

```{r}

```

```{r}

```
